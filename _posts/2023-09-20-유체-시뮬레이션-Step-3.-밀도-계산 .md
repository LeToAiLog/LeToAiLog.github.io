---
title: ìœ ì²´ ì‹œë®¬ë ˆì´ì…˜ Step 3. Density calculation
description: ìœ ì²´ ì‹œë®¬ë ˆì´ì…˜(Smoothed Particle Hydrodynamics)ì„ êµ¬í˜„í•˜ê¸° ìœ„í•œ ì„¸ ë²ˆì§¸ ê±¸ìŒ
date: 2023-09-20 23:15:15 +09:00
categories: [Smoothed Particle Hydrodynamics]
tags: [Smoothed Particle Hydrodynamics, fluid simulation, physics simulation, ìœ ì²´ ì‹œë®¬ë ˆì´ì…˜, fluid, ìœ ì²´, ë¬¼ë¦¬ ì‹œë®¬ë ˆì´ì…˜, ì…ì ì‹œë®¬ë ˆì´ì…˜, Particles, ì…ì, SPH]
pin: true
math: true
mermaid: true
image:
  path: /assets/img/smoothed-particle-hydrodynamics/SmoothingKernelFigurewithWhiteBackground.png
  # ëŒ€í‘œ ì´ë¯¸ì§€ì˜ ì• ë‹ˆë©”ì´ì…˜ ì ìš©
  lqip: data:image/webp;base64,UklGRpoAAABXRUJQVlA4WAoAAAAQAAAADwAABwAAQUxQSDIAAAARL0AmbZurmr57yyIiqE8oiG0bejIYEQTgqiDA9vqnsUSI6H+oAERp2HZ65qP/VIAWAFZQOCBCAAAA8AEAnQEqEAAIAAVAfCWkAALp8sF8rgRgAP7o9FDvMCkMde9PK7euH5M1m6VWoDXf2FkP3BqV0ZYbO6NA/VFIAAAA
  alt: Particle approximation using particles within the particle range(â„), ğ‘˜â„ is the particle range, $r_{ij}$ is the distance between the neighbor particle and the central particle(red).
---
<!--  -->
# **Density calculation**
![í‰í™œ ì…ì ìœ ì²´ì—­í•™ ì»¤ë„ ê·¸ë¦¼](/assets/img/smoothed-particle-hydrodynamics/SmoothingKernelFigurewithWhiteBackground.png){:width="500" height="589" style="border:1px solid #eaeaea; border-radius: 10px; padding: 0px;"} 
_**<span style="color:deepskyblue; font-size:150%">Figure 1. </span>
<span style="color:gainsboro;font-size:150%">Particle approximation using particles within the particle range(â„), ğ‘˜â„ is the particle range, $$r_{ij}$$ is the distance between the neighbor particle and the central particle(red).</span>**_
<hr>

## Kernel function ##

ë°€ë„ëŠ” ì¤‘ì‹¬ ì…ìë¡œë¶€í„° `Smooting length`ì˜ ì˜ì—­ì— ë“¤ì–´ê°€ëŠ” ì´ì›ƒ ì…ìë¥¼ í¬í•¨í•˜ì—¬ ê³„ì‚°í•´ì•¼ í•œë‹¤.

ë°€ë„ë¥¼ ê³„ì‚°í•˜ëŠ” ì‹ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

$$
\begin{aligned}
  \rho _{s}(r) &= \sum_{j}^{}m_{j}\frac{\rho_{j}}{\rho_{j}}W(r-r_{j}, h) = \sum_{j}^{}m_{j}W(r-r_{j}, h) 
\end{aligned}
$$

ÏëŠ” ë°€ë„ë¥¼ ë‚˜íƒ€ë‚´ë©° ë°©ì •ì‹ì´ ì–´ë–»ê²Œ ìœ ë„ë˜ëŠ”ì§€ì— ëŒ€í•´ ìì„¸íˆ ì•Œê³  ì‹¶ë‹¤ë©´ í•´ë‹¹ ë§í¬ë¥¼ ì°¸ê³ í•˜ê¸¸ ë°”ë€ë‹¤.
[Smoothed Particle Hydrodynamics](https://www.annualreviews.org/doi/abs/10.1146/annurev.aa.30.090192.002551?journalCode=astro)

ë˜í•œ, ì–´ë–»ê²Œ êµ¬í˜„ë˜ì—ˆëŠ”ì§€ ê¶ê¸ˆí•˜ë‹¤ë©´ í•´ë‹¹ ë§í¬ë¥¼ ì°¸ê³ í•˜ê¸¸ ë°”ë€ë‹¤.
[Particle-Based Fluid Simulation for Interactive Applications](https://citeseerx.ist.psu.edu/document?repid=rep1&type=pdf&doi=1739fd145ef1d327ab301cacc017af2a87f33086)

ë°©ì •ì‹ì„ ì»´í“¨í„°ì—ì„œ ê³„ì‚°í•˜ê¸° ìœ„í•´ì„œëŠ” ê° ìš”ì†Œë¥¼ ë¶„í•´í•˜ê³  ê³„ì‚°ë˜ëŠ” ìˆœì„œëŒ€ë¡œ ë°°ì¹˜í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.

ê°„ë‹¨í•˜ê²Œ ì½”ë“œë¡œ í‘œí˜„í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

```python
def computeDensity(posX, posY, posZ, particlePos, ntotal):
    dens = 0.0
    for i in range(ntotal):
        dens += MASS * densKernel(posX - particlePos[0][i], posY - particlePos[1][i],posZ - particlePos[2][i], SUPPORT_RADIUS)   
    #print("dens : ",dens)
    return dens
```
`posX, posY, posZ`ëŠ” ì¤‘ì‹¬ ì…ìì˜ ìœ„ì¹˜ì´ê³  ì…ì `particlePos`ëŠ” ì´ì›ƒ ì…ìì˜ ìœ„ì¹˜ì´ë‹¤. `ntotal`ì€ ì…ìì˜ ìˆ˜ë¥¼ ë‚˜íƒ€ë‚´ë©° ì´í•´í•˜ê¸° ì‰½ë„ë¡ ì§ë ¬ë¡œ êµ¬í˜„í–ˆë‹¤.

`Kernel function`ì˜ ê¸°ëŠ¥ì€ ìœ ì²´ì˜ íŠ¹ì„±ì— ë”°ë¼ ë‹¬ë¼ì§„ë‹¤.

ë°€ë„ ê³„ì‚°ì— ì‚¬ìš©ë˜ëŠ” `Kernel function`ì—ëŠ” `Poly6`, `CubicSpline` ë° `Gaussianì´` ë“±ì´ ìˆìœ¼ë©°, í•´ë‹¹ êµ¬í˜„ì—ì„œëŠ” `Poly6`ë¡œ ë°€ë„ë¥¼ ê³„ì‚°í•˜ëŠ”ë° ì‚¬ìš©í•œë‹¤.

$$
\begin{aligned}
W_{poly6}(r,h) &= \frac{315}{64\pi h^{9}}
\left\{\begin{matrix}
(h^{2}-r^{2})^{3}\\ 
0
\end{matrix}\right.
\end{aligned}
$$

ì—¬ê¸°ì„œ $W$ëŠ” `Kernel function`ì„ ë‚˜íƒ€ë‚´ê³ , **$r$**ì€ ì¤‘ì‹¬ ì…ìì™€ ì´ì›ƒ ì…ì ì‚¬ì´ì˜ ê±°ë¦¬ë¥¼ ë‚˜íƒ€ë‚´ë©°, $h$ëŠ” `Smoothing length`ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.

```python
def densKernel(diffX,diffY,diffZ, r):
    dist = sqrt(diffX*diffX+diffY*diffY+diffZ*diffZ)
    if dist > r:
        return 0.0
    else:
        return (315.0 / (64.0 * PI * pow(r, 9.0))) * pow(r * r - dist * dist, 3.0)
```
ë°€ë„ ê³„ì‚°ì€ ìœ„ì™€ ê°™ì´ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.
ë¬¼ë¦¬í•™ì—ì„œ ì§ˆëŸ‰ì„ êµ¬í•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìœ¼ë¯€ë¡œ ë°€ë„ ë˜í•œ êµ¬í•˜ëŠ”ë° ì–´ë µì§€ì•Šë‹¤.

$$m = \rho V$$

ì—¬ê¸°ì„œ $m$ì€ ì§ˆëŸ‰, $\rho $ëŠ” ë°€ë„, $V$ëŠ” ë¶€í”¼ë¥¼ ì˜ë¯¸í•œë‹¤.

>`Computing simulation`ì—ì„œëŠ” $V$ë¥¼ ì•„ì£¼ ì‘ì€ ë‹¨ìœ„ê¹Œì§€ ìª¼ê°œì§€ ëª»í•˜ê¸° ë•Œë¬¸ì— ì¼ë°˜ì ìœ¼ë¡œ ì›í•˜ëŠ” `Simulation`ì˜ ì–‘ìƒì„ ë§Œë“œëŠ” ê²ƒì— ë§Œì¡±í•  ìˆ˜ ìˆë‹¤ë©´ $V$ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìµœì†Œí•œì˜ ë¯¸ì†Œ ì²´ì ìœ¼ë¡œ ì‚¼ì•„ ì§ˆëŸ‰ì„ ê³„ì‚°í•œë‹¤. ì‚¬ì‹¤ìƒ $V$ì•ì—ëŠ” $\Delta $ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤.
{: .prompt-info }

