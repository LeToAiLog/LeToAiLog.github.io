---
title: ìœ ì²´ ì‹œë®¬ë ˆì´ì…˜ Step 2. Initialization module
description: ìœ ì²´ ì‹œë®¬ë ˆì´ì…˜(Smoothed Particle Hydrodynamics)ì„ êµ¬í˜„í•˜ê¸° ìœ„í•œ ë‘ ë²ˆì§¸ ê±¸ìŒ
date: 2023-9-13 18:19:41 +09:00
categories: [Smoothed Particle Hydrodynamics]
tags: [Smoothed Particle Hydrodynamics, fluid simulation, physics simulation, ìœ ì²´ ì‹œë®¬ë ˆì´ì…˜, fluid, ìœ ì²´, ë¬¼ë¦¬ ì‹œë®¬ë ˆì´ì…˜, ì…ì ì‹œë®¬ë ˆì´ì…˜, Particles, ì…ì, SPH]
pin: true
math: true
mermaid: true
image:
  path: /assets/img/smoothed-particle-hydrodynamics/FigureCubeandBunny.png
  # ëŒ€í‘œ ì´ë¯¸ì§€ì˜ ì• ë‹ˆë©”ì´ì…˜ ì ìš©
  lqip: data:image/webp;base64,UklGRpoAAABXRUJQVlA4WAoAAAAQAAAADwAABwAAQUxQSDIAAAARL0AmbZurmr57yyIiqE8oiG0bejIYEQTgqiDA9vqnsUSI6H+oAERp2HZ65qP/VIAWAFZQOCBCAAAA8AEAnQEqEAAIAAVAfCWkAALp8sF8rgRgAP7o9FDvMCkMde9PK7euH5M1m6VWoDXf2FkP3BqV0ZYbO6NA/VFIAAAA
  alt: (Left) Cube shape (Right) Stanford bunny shape.
---
<!--  -->
# **Module ì´ˆê¸°í™”**
<hr>

## ë§¤ê°œë³€ìˆ˜ë¥¼ ì´ˆê¸°í™”í•œ í›„ì—ëŠ” ì´ì œ ì´ëŸ¬í•œ ë§¤ê°œë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ê³„ì‚°í•˜ì—¬ ë„£ì„ ê°’ì˜ ê·¸ë¦‡ì„ ë§Œë“¤ì–´ì•¼ í•œë‹¤.<br><br>êµ¬í˜„ì€ ì§ê´€ì ì¸ ì´í•´ë¥¼ ìœ„í•´ **python**ì„ í†µí•´ êµ¬í˜„ë˜ë©° [**`VPython`**](https://vpython.org/)ìœ¼ë¡œ ì‹œë®¬ë ˆì´ì…˜ì„ ì‹œê°í™”í•œë‹¤.<br><br>VPythonì€ ê°„ë‹¨í•œ ë¬¼ë¦¬ ì‹¤í—˜ì„ ì‹œê°í™”í•˜ê¸° ìœ„í•œ ë„êµ¬ë¡œ **openGL**ì„ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„ëœ Python íŒ¨í‚¤ì§€ì´ë‹¤.
<hr>

### **Template ì´ˆê¸°í™”**

ëª¨ë“  ìœ ì²´ ì…ìê°€ ìœ ì²´ì˜ ìœ„ì¹˜ë¥¼ ìœ ì§€í•˜ë ¤ë©´ ìœ„ì¹˜ë¥¼ ì´ˆê¸°í™”í•´ì•¼ í•œë‹¤.
ì´ ê°’ì€ $x,y,z$ë¡œ í‘œì‹œë˜ëŠ” ìŠ¤ì¹¼ë¼ ê°’ì´ë‹¤.<br>

```python
import numpy as np
import time
import pandas as pd

from SPH_Density import computeDensity
from SPH_Pressure import computePressure, computePressForce
from SPH_Viscosity import computeViscForce
from SPH_Normal import computeNormal
from SPH_SurfaceTension import comptueSurfaceTensionForce

from Parameters_Output import *
from Object import ObjRead
from Particles import *
from vpython import *

scene = canvas(
  background=color.white,
  width=1200,
  height=700,
  center=vector(0, 0, 0),
  scale=(1.0, 1.0, 1.0),
  forward=vector(-0.005, -0.005, -0.005),
  autoscale=1,
)

scene_number = "_scene1"

x_pos, y_pos, z_pos = ObjRead.init_Cube_Shape()
ntotal = len(x_pos)
particle = np.zeros((3, ntotal), dtype=np.float32)
```

ê° ì¶•ì˜ ë²¡í„°ë¥¼ 2ì°¨ì›ìœ¼ë¡œ í‘œí˜„í•˜ì—¬ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ê²ƒì´ ì ‘ê·¼ì„± ë©´ì—ì„œ ë” í¸í•˜ë‹¤.
í•˜ì§€ë§Œ ì´í•´ë¥¼ ìœ„í•´ ì…ì ìœ„ì¹˜ì˜ ë‚´ìš©ì„ ê°ê° $x,y,z$ë¡œ ì‘ì„±í–ˆë‹¤.

`x_pos`, `y_pos`, `z_pos`ëŠ” listì´ë©° **`ObjRead`**ì—ì„œ ì›í•˜ëŠ” ëª¨ì–‘ì˜ ì…ì ì„¸íŠ¸ ìœ„ì¹˜ë¥¼ í˜¸ì¶œí•œë‹¤.
ì—¬ê¸°ì—ì„œ ì‚¬ìš©ëœ ì…ì ì„¸íŠ¸ëŠ” `Cube`ì´ë‹¤.

CubeëŠ” [**`Pandas`**](https://pandas.pydata.org/)ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¯¸ë¦¬ ì €ì¥ëœ csv íŒŒì¼ì„ ì½ì–´ì„œ ë¶ˆëŸ¬ì˜¨ë‹¤.<br><br>
  
| Particle index |    $x$     |    $y$     |     $z$     |
| :------------: | :--------: | :--------: | :---------: |
|       1        | -0.1222185 | -0.1222185 | -0.1222185  |
|       2        | -0.1222185 | -0.1222185 | -0.09505883 |
|       3        | -0.1222185 | -0.1222185 | -0.06789917 |
|       â‹®        |     â‹®      |     â‹®      |      â‹®      |
  
_**<span style="color:deepskyblue; font-size:100%">Table 1. </span>
<span style="color:gainsboro;font-size:100%"> The position of the particles is separated into x, y, and z axes, and the values for each particle are shown in the table.</span>**_

![íë¸Œì™€ ìŠ¤íƒ í¬ë“œ í† ë¼ ëª¨ì–‘ìœ¼ë¡œ ë°°ì¹˜í•œ ìœ ì²´ ì…ìë“¤](/assets/img/smoothed-particle-hydrodynamics/FigureCubeandBunny.png){:width="800" height="400" style="border:1px solid #eaeaea; border-radius: 10px; padding: 0px;"} 
_**<span style="color:deepskyblue; font-size:150%">Figure 1. </span>
<span style="color:gainsboro;font-size:150%"> (Left) Cube shape (Right) Stanford bunny shape</span>**_

ì„¤ì •í•œ ëª¨ì–‘ì— ë”°ë¼ ì´ ì…ì ìˆ˜ê°€ ë‹¬ë¼ì§€ê¸° ë•Œë¬¸ì— csvì—ì„œ ë°›ì•„ì˜¨ í–‰ ìˆ˜ì— ë”°ë¼ ì´ ì…ììˆ˜ë¥¼ ê²°ì •í•œë‹¤.

```python
x_pos, y_pos, z_pos = ObjRead.init_Cube_Shape()
ntotal = len(x_pos)
particle = np.zeros((3, ntotal), dtype=np.float32)
```

**`Density`**, **`Pressure`** ë“±ì€ ê° ì…ìì˜ ìˆ˜ì— ë”°ë¼ ì´ˆê¸°í™”ë˜ì–´ì•¼ í•œë‹¤. ë¹ˆ listì—ëŠ” ì‹œë®¬ë ˆì´ì…˜ì´ ì§„í–‰ë¨ì— ë”°ë¼ ê²°ì •ëœ ê°’ì´ ì±„ì›Œì§„ë‹¤.
ì¤‘ìš”í•œ ì ì€ ìŠ¤ì¹¼ë¼ì™€ ë²¡í„°ë¥¼ ì˜ êµ¬ë¶„í•˜ì—¬ listì˜ ì°¨ì›ì„ ê²°ì •í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì´ë‹¤.
<hr>

### **ê²½ê³„ ì¡°ê±´**

ì¼ë°˜ì ìœ¼ë¡œ ê²½ê³„ ì¡°ê±´ì—ëŠ” ë‘ ê°€ì§€ê°€ ìˆë‹¤.
ì—´ë¦° ê³„ë©´(Open interface), ë‹«íŒ ê³„ë©´(Closed interface)ì´ë‹¤.

ì—´ë¦° ê³„ë©´ì˜ ê²½ìš°, ì…ì ê¸°ë°˜(Particle-based) ìœ ì²´ ì‹œë®¬ë ˆì´ì…˜ì—ì„œ ì¢…ì¢… ì…ìê°€ ê²½ê³„ ë°–ìœ¼ë¡œ íƒˆì¶œí•˜ê¸° ë•Œë¬¸ì— ì‹œë®¬ë ˆì´ì…˜ì´ ë„ë©”ì¸ ë‚´ì—ì„œ ì‹¤í–‰ë  ìˆ˜ ìˆë„ë¡ ê²½ê³„ë³´ë‹¤ í° ë„ë©”ì¸ì„ ì„¤ì •í•˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤.

ë‹«íŒ ê³„ë©´ì€ ì…ìê°€ ë¹ ì ¸ë‚˜ê°€ëŠ” ê²ƒì´ ë¶ˆê°€ëŠ¥í•  ê²ƒìœ¼ë¡œ ìƒê°ë˜ì§€ë§Œ, `Delta time`ì„ ì˜ëª» ì„¤ì •(ëŒ€ì²´ë¡œ í° Delta timeì˜ ì„¤ì •)í•˜ë©´ ê³„ë©´ê³¼ ì¶©ëŒí•˜ì—¬ ê²½ê³„ë¥¼ ë²—ì–´ë‚˜ë”ë¼ë„ ì¸ì‹ë˜ì§€ ì•Šì•„ ì…ìê°€ ë°–ìœ¼ë¡œ íƒˆì¶œí•  ìˆ˜ ìˆë‹¤. ì´ ê²½ìš° ê²½ê³„ ì¡°ê±´ì„ ì…ìê°€ ì•„ë‹Œ ë©”ì‰¬ë¡œ ì„¤ì •í•˜ì—¬ ë‚´ë¶€ì™€ ì™¸ë¶€ë¥¼ êµ¬ë¶„í•˜ê³ , íƒˆì¶œí•˜ë©´ ì…ìë¥¼ ê°•ì œë¡œ ë©”ì‰¬(Mesh)ë°–ì—ì„œ ê²½ê³„ì—ì„œ ì–¼ë§ˆë‚˜ ë²—ì–´ë‚¬ëŠ”ì§€ì— ëŒ€í•´ íƒ„ì„±, ê·¸ ì™¸ ì™¸ë ¥ë“¤ì„ ê³„ì‚°í•˜ì—¬ ë„ë©”ì¸(Domain)ì•ˆìœ¼ë¡œ ë‹¤ì‹œ ê³„ì‚°í•˜ì—¬ ë°©í–¥(`Normal vector` ì‚¬ìš©)ì„ ë°”ê¾¼ë‹¤.

êµ¬í˜„ì—ì„œ ì‚¬ìš©ë˜ëŠ” ê²½ê³„ëŠ” ì…ìë¥¼ ê°€ë‘ê¸° ìœ„í•´ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆëŠ” Cubeë¥¼ ì‚¬ìš©í•œë‹¤.

```python
def isCollision(i, pos):
    global contactNormal
    global contactPos

    if (
        abs(pos[0][i]) <= BOX_SIZE / 2
        and abs(pos[1][i]) <= BOX_SIZE / 2
        and abs(pos[2][i]) <= BOX_SIZE / 2
    ):
        return False

    maxComponent = "x"
    maxValue = abs(pos[0][i])
    if maxValue < abs(pos[1][i]):
        maxComponent = "y"
        maxValue = abs(pos[1][i])
    if maxValue < abs(pos[2][i]):
        maxComponent = "z"
        maxValue = abs(pos[2][i])

    if maxComponent == "x":
        if pos[0][i] < -BOX_SIZE / 2:
            contactPos = [pos[0][i], pos[1][i], pos[2][i]]
            contactPos[0] = -BOX_SIZE / 2
            if pos[1][i] < -BOX_SIZE / 2:
                contactPos[1] = -BOX_SIZE / 2
            elif pos[1][i] > BOX_SIZE / 2:
                contactPos[1] = BOX_SIZE / 2
            if pos[2][i] < -BOX_SIZE / 2:
                contactPos[2] = -BOX_SIZE / 2
            elif pos[2][i] > BOX_SIZE / 2:
                contactPos[2] = BOX_SIZE / 2
            contactNormal = [1.0, 0.0, 0.0]
            return True
        elif pos[0][i] > BOX_SIZE / 2:
            contactPos = [pos[0][i], pos[1][i], pos[2][i]]
            contactPos[0] = BOX_SIZE / 2
            if pos[1][i] < -BOX_SIZE / 2:
                contactPos[1] = -BOX_SIZE / 2
            elif pos[1][i] > BOX_SIZE / 2:
                contactPos[1] = BOX_SIZE / 2
            if pos[2][i] < -BOX_SIZE / 2:
                contactPos[2] = -BOX_SIZE / 2
            elif pos[2][i] > BOX_SIZE / 2:
                contactPos[2] = BOX_SIZE / 2
            contactNormal = [-1.0, 0.0, 0.0]
            return True
    elif maxComponent == "y":
        if pos[1][i] < -BOX_SIZE / 2:
            contactPos = [pos[0][i], pos[1][i], pos[2][i]]
            contactPos[1] = -BOX_SIZE / 2
            if pos[0][i] < -BOX_SIZE / 2:
                contactPos[0] = -BOX_SIZE / 2
            elif pos[0][i] > BOX_SIZE / 2:
                contactPos[0] = BOX_SIZE / 2
            if pos[2][i] < -BOX_SIZE / 2:
                contactPos[2] = -BOX_SIZE / 2
            elif pos[2][i] > BOX_SIZE / 2:
                contactPos[2] = BOX_SIZE / 2
            contactNormal = [0.0, 1.0, 0.0]
            return True
        elif pos[1][i] > BOX_SIZE / 2:
            contactPos = [pos[0][i], pos[1][i], pos[2][i]]
            contactPos[1] = BOX_SIZE / 2
            if pos[0][i] < -BOX_SIZE / 2:
                contactPos[0] = -BOX_SIZE / 2
            elif pos[0][i] > BOX_SIZE / 2:
                contactPos[0] = BOX_SIZE / 2
            if pos[2][i] < -BOX_SIZE / 2:
                contactPos[2] = -BOX_SIZE / 2
            elif pos[2][i] > BOX_SIZE / 2:
                contactPos[2] = BOX_SIZE / 2
            contactNormal = [0.0, -1.0, 0.0]
            return True
    elif maxComponent == "z":
        if pos[2][i] < -BOX_SIZE / 2:
            contactPos = [pos[0][i], pos[1][i], pos[2][i]]
            contactPos[2] = -BOX_SIZE / 2
            if pos[0][i] < -BOX_SIZE / 2:
                contactPos[0] = -BOX_SIZE / 2
            elif pos[0][i] > BOX_SIZE / 2:
                contactPos[0] = BOX_SIZE / 2
            if pos[1][i] < -BOX_SIZE / 2:
                contactPos[1] = -BOX_SIZE / 2
            elif pos[1][i] > BOX_SIZE / 2:
                contactPos[1] = BOX_SIZE / 2
            contactNormal = [0.0, 0.0, 1.0]
            return True
        elif pos[2][i] > BOX_SIZE / 2:
            contactPos = [pos[0][i], pos[1][i], pos[2][i]]
            contactPos[2] = BOX_SIZE / 2
            if pos[0][i] < -BOX_SIZE / 2:
                contactPos[0] = -BOX_SIZE / 2
            elif pos[0][i] > BOX_SIZE / 2:
                contactPos[0] = BOX_SIZE / 2
            if pos[1][i] < -BOX_SIZE / 2:
                contactPos[1] = -BOX_SIZE / 2
            elif pos[1][i] > BOX_SIZE / 2:
                contactPos[1] = BOX_SIZE / 2
            contactNormal = [0.0, 0.0, -1.0]
            return True
```

**`isCollision`**ì€ ì…ìê°€ ê²½ê²Œì— ë‹¿ê±°ë‚˜ ë²—ì–´ë‚˜ë©´ `True`, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ `False`ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
í‘œí˜„ì‹ì€ ë” ê°„ë‹¨í•˜ê²Œ ì‘ì„±í•  ìˆ˜ ìˆì§€ë§Œ í•¨ìˆ˜ ì•ˆì˜ ë‚´ìš©ì„ ì‚´í”¼ë©´ì„œ ê°’ì´ ì–´ë–»ê²Œ ë°˜í™˜ë˜ëŠ”ì§€ ì´í•´í•˜ê¸° ì‰½ê²Œ í’€ì–´ì„œ ì½”ë“œë¥¼ ì‘ì„±í–ˆë‹¤.

ë§¤ê°œë³€ìˆ˜ì—ì„œ `i`ì™€ `pos`ëŠ” ê°ê° ì¤‘ì‹¬ì…ìì˜ `index`ì™€ ì…ìì˜ ìœ„ì¹˜ë¥¼ ë‚˜íƒ€ë‚´ë©°, ìœ„ì¹˜ê°€ `Cube`ì˜ ê²½ê³„ì—ì„œ ë²—ì–´ë‚  ë•Œë¥¼ ì•Œ ìˆ˜ ìˆë„ë¡ í•˜ê¸°ìœ„í•´ isCollisionì˜ ë§¤ê°œë³€ìˆ˜ë¡œ í™œìš©ëœë‹¤.

![í‰í™œ ì…ì ìœ ì²´ì—­í•™ ì»¤ë„ ê·¸ë¦¼](/assets/img/smoothed-particle-hydrodynamics/FigureDomainRange.png){:width="500" height="600" style="border:1px solid #eaeaea; border-radius: 10px; padding: 0px;"} 
_**<span style="color:deepskyblue; font-size:150%">Figure 2. </span>
<span style="color:gainsboro;font-size:150%">A picture showing the boundaries with cube-shaped particles.</span>**_

Figure 2.ì—ì„œ `Cube` ëª¨ì–‘ì˜ ì…ìë“¤ì´ ë°˜í™˜í•˜ëŠ” `isCollision`ì˜ returnê°’ì€ `False`ë¡œ `Boundary`ì•ˆì— ì…ìë“¤ì´ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

ìœ„ì˜ ì½”ë“œ ì¤‘ ëª¨ë“  ì¶•ì—ì„œ `contactNormal`ê°’ì€ ìŒê³¼ ì–‘ì˜ ê°’ì— ëŒ€í•´ ê³„ì‚°ë˜ì–´ì•¼ í•œë‹¤.
`Boundary`ë¥¼ ì´ë£¨ëŠ” ì •ìœ¡ë©´ì²´ ëª¨ì–‘ì€ 6ê°œì˜ ë©´ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤.
ê° ì¶• $x, y, z$ì— ëŒ€í•´ `contactNormal`ì˜ ìŒê³¼ ì–‘ì˜ ê°’ì„ ê³„ì‚°í•˜ë©´ ì´ 6ê°œë¡œ ì •ìœ¡ë©´ì²´ ëª¨ì–‘ì˜ ê²½ê³„ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

ì—¬ê¸°ì—ì„œëŠ” ê°„ë‹¨í•˜ê²Œ êµ¬í˜„ ê°€ëŠ¥í•œ ì •ìœ¡ë©´ì²´ ëª¨ì–‘ì˜ ê²½ê³„ë¥¼ êµ¬í˜„í–ˆìœ¼ë‚˜, ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ ë” ë³µì¡í•œ ê²½ê³„ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´, í† ë¼ ëª¨ì–‘ì˜ ê²‰ë©´ì˜ ìœ„ì¹˜ì •ë³´ë¥¼ ì—¬ê¸°ì—ì„œ ì‚¬ìš©í•œ ê²ƒì²˜ëŸ¼ ìœ„ì¹˜ ì •ë³´ë¥¼ ë°›ì•„ì™€ ë©”ì‰¬(Mesh)ë¡œ ë§Œë“¤ì–´ì„œ isCollisionì˜ ì…ìë“¤ì˜ ìœ„ì¹˜ë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ì‚¬ìš©í•˜ì—¬ ê²½ê³„ë¥¼ êµ¬í˜„í•œë‹¤ë©´ ìœ ì²´ë¥¼ ê°€ë“ì±„ì› ì„ ë•Œ ë°”ë‹¥ë¶€í„° ì°¨ì˜¤ë¥´ëŠ” í† ë¼ëª¨ì–‘ì˜ ì»µì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

>ì‹œë®¬ë ˆì´ì…˜ì˜ ê°€ì†ì„ ìœ„í•´ ë§ì€ ì‹œë®¬ë ˆì´ì…˜ë“¤ì´ `C++`ì„ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„ëœë‹¤. ë˜í•œ, ë©€í‹° í”„ë¡œì„¸ì‹±ì´ë‚˜ ê·¸ë˜í”½ì¹´ë“œë¥¼ ì´ìš©í•œ ë³‘ë ¬ì²˜ë¦¬ë¥¼ í†µí•´ ì‹œë®¬ë ˆì´ì…˜ì„ ê°€ì†í™”í•œë‹¤.
{: .prompt-info }
<!-- ì´ë¯¸ì§€ -->
<!-- ![í‰í™œ ì…ì ìœ ì²´ì—­í•™ ì»¤ë„ ê·¸ë¦¼](/assets/img/smoothed-particle-hydrodynamics/SmoothingKernelFigurewithWhiteBackground.png){:width="500" height="589" style="border:1px solid #eaeaea; border-radius: 10px; padding: 0px;"} 
_**<span style="color:deepskyblue; font-size:150%">Figure 1. </span>
<span style="color:gainsboro;font-size:150%">Particle approximation using particles within the particle range(â„), ğ‘˜â„ is the particle range, $$r_{ij}$$ is the distance between the neighbor particle and the central particle(red).</span>**_ -->